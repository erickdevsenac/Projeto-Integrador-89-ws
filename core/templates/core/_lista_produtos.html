{% load static %}

{% comment %}
O único conteúdo aqui deve ser o que é atualizado pelo AJAX.
A tag `load pagination_tags` foi removida daqui, pois o `_pagination.html` a carregará se necessário.
{% endcomment %}

{% if page_obj %}
<div class="row g-4">

    {% for produto in page_obj %}
    <div class="col-md-4 col-sm-6">
        <div class="produto-card">
            <div class="card h-100">

                {% if produto.motivo_desconto == 'VALIDADE' %}
                <div class="produto-badge badge-warning" style="position: absolute; background-color: #d64545; color: #fff;; border-radius: 3px; padding-left: 5px; padding-right: 10px;">
                    <i class="fas fa-clock"></i> Vence em breve
                </div>
                {% endif %}

                {% if produto.estoque_baixo %}
                <div class="produto-badge badge-danger" style="position: absolute; background-color: #f4b400; color: #ffffff; border-radius: 3px; padding-left: 5px; padding-right: 10px;">
                    <i class="fas fa-exclamation"></i> Últimas unidades
                </div>
                {% endif %}

                <div class="produto-image">
                    <a href="{% url 'core:produto_detalhe' produto.id %}">
                        {% if produto.imagem_principal %}
                        <img src="{{ produto.imagem_principal.url }}"
                             alt="{{ produto.nome }}"
                             class="card-img-top"
                             loading="lazy">
                        {% else %}
                        <img src="{% static 'assets/img/placeholder_produto.png' %}"
                             class="card-img-top"
                             alt="Sem imagem">
                        {% endif %}
                    </a>
                </div>

                <div class="card-body">
                    <small class="text-muted">{{ produto.vendedor.nome_negocio }}</small>
                    <h5 class="card-title">
                            {{ produto.nome }}

                    </h5>

                    <div class="produto-preco">
                        <span class="preco-atual">
                            R$ {{ produto.preco|floatformat:2 }}
                        </span>
                        {% if produto.preco_original %}
                        <span class="preco-original">
                            R$ {{ produto.preco_original|floatformat:2 }}
                        </span>
                        {% endif %}
                    </div>
                </div>

                <div class="card-footer">
                    {% if produto.disponivel_para_venda %}
                    <form method="POST"
                          action="{% url 'core:adicionar_carrinho' produto.id %}">
                        {% csrf_token %}
                        <button class="btn btn-success btn-sm w-100">
                            <i class="fas fa-cart-plus me-1"></i> Adicionar
                        </button>
                    </form>
                    {% else %}
                    <button class="btn btn-secondary btn-sm w-100" disabled>
                        Indisponível
                    </button>
                    {% endif %}
                </div>

            </div>
        </div>
    </div>
    {% endfor %}

    {% for pacote in pacotes %}
    <div class="col-md-4 col-sm-6">
        <div class="produto-card">
            <div class="card h-100">

                <div class="produto-image">
                    <a href="{% url 'core:pacote_detalhe' pacote.id %}">
                        {% if pacote.imagem %}
                        <img src="{{ pacote.imagem.url }}"
                             class="card-img-top"
                             alt="{{ pacote.nome }}">
                        {% else %}
                        <img src="{% static 'assets/img/placeholder_produto.png' %}"
                             class="card-img-top">
                        {% endif %}
                    </a>
                </div>

                <div class="card-body">
                    <h5>{{ pacote.nome }}</h5>
                    <span class="preco-atual">
                        R$ {{ pacote.preco|floatformat:2 }}
                    </span>
                </div>

                <div class="card-footer">
                    {% if pacote.esta_disponivel_agora %}
                    <form method="POST"
                          action="{% url 'core:adicionar_pacote_carrinho' pacote.id %}">
                        {% csrf_token %}
                        <button class="btn btn-success btn-sm w-100">
                            <i class="fas fa-cart-plus me-1"></i> Adicionar
                        </button>
                    </form>
                    {% else %}
                    <button class="btn btn-secondary btn-sm w-100" disabled>
                        Indisponível
                    </button>
                    {% endif %}
                </div>

            </div>
        </div>
    </div>
    {% endfor %}

</div>

<div class="mt-4">
    {% include 'core/_pagination.html' %}
</div>

{% else %}
<div class="text-center py-5">
    <i class="fas fa-search fa-3x text-muted mb-3"></i>
    <h4>Nenhum produto encontrado</h4>
    <p class="text-muted">Tente ajustar os filtros.</p>
</div>
{% endif %}