{% extends 'global/base.html' %}
{% load static %}

{% block head %}
<title>Finalizar Compra - Aproveite+</title>
<script src="{% static 'core/static/assets/formsEndereco.js' %}"></script>
{% endblock %}

{% block content %}
<div class="checkout-container">
  <div class="container">
    <h2 class="fw-bold mb-5 text-dark">Finalizar Compra</h2>

    <div class="row g-5">
      <div class="col-md-5 col-lg-4 order-md-last">
        <div class="card card-resumo p-3">
          <h4 class="d-flex justify-content-between align-items-center mb-4 px-2">
            <span class="text-secondary">Seu Carrinho</span>
            <span class="badge rounded-pill" style="color: #ffff; background-color: #288a0a;">{{ carrinho|length }}</span>
          </h4>
          <ul class="list-group list-group-flush mb-3">
            {% for item in carrinho %}
            <li class="list-group-item d-flex justify-content-between lh-sm">
              <div>
                <h6 class="my-0 fw-bold">{{ item.nome }}</h6>
                <small class="text-muted">Quantidade: {{ item.quantidade }}</small>
              </div>
              <span class="fw-semibold text-dark">R$ {{ item.preco|floatformat:2 }}</span>
            </li>
            {% endfor %}

            {% if valor_desconto %}
            <li class="list-group-item d-flex justify-content-between bg-light">
              <div class="text-success">
                <h6 class="my-0">Cupom aplicado</h6>
                <small>{{ cupom.codigo }}</small>
              </div>
              <span class="text-success">− R$ {{ valor_desconto|floatformat:2 }}</span>
            </li>
            {% endif %}
            <li class="list-group-item d-flex justify-content-between pt-3">
              <span class="fs-5 fw-bold" style="color: #288a0a;">Total</span>
              <strong class="fs-5 " style="color: #288a0a;">R$ {{ total_final|default:total_carrinho|floatformat:2 }}</strong>
            </li>
          </ul>

          <form method="post" action="{% url 'core:aplicar_cupom' %}" class="p-2">
            {% csrf_token %}
            <h6 class="text" style="color: #288a0a;">Aplicar cupom:</h6>
            <div class="input-group">
              <input type="text" name="codigo" class="form-control form-control-sm" placeholder="Ex: 2025-aproveite">
              <button class="btn btn-dark" type="submit">Aplicar</button>
            </div>
          </form>
          
        </div>
      </div>

      <div class="col-md-7 col-lg-8">
        <div class="card p-4 shadow-sm border-0" style="border-radius: 12px;">
          <h4 class="mb-4 border-bottom pb-2">Informações de Entrega</h4>
          <form method="post" action="{% url 'core:checkout' %}" novalidate>
            {% csrf_token %}

            <div class="form-check mb-4">
              <input class="form-check-input" type="checkbox" id="usarEnderecoCadastro" checked>
              <label class="form-check-label fw-semibold" for="usarEnderecoCadastro">
                Usar endereço do meu cadastro
              </label>
            </div>

            
          <div id="shippingContainer">
            <div class="row g-3">


            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold">Nome completo</label>
                <input type="text" class="form-control" name="nome" value="{{ usuario.nome }}" required>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Telefone</label>
                <input type="tel" class="form-control" name="telefone" value="{{ usuario.telefone }}" placeholder="(99) 99999-9999" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">CEP</label>
                <input type="text" class="form-control" name="cep" value="{{ usuario.cep }}" placeholder="00000-000" required>
              </div>

              <div class="col-md-8">
                <label class="form-label fw-semibold">Rua</label>
                <input type="text" class="form-control" name="rua" value="{{ usuario.rua }}" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Número</label>
                <input type="text" class="form-control" name="numero" value="{{ usuario.numero }}" required>
              </div>

              <div class="col-md-8">
                <label class="form-label fw-semibold">Complemento</label>
                <input type="text" class="form-control" name="complemento" value="{{ usuario.complemento }}">
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Bairro</label>
                <input type="text" class="form-control" name="bairro" value="{{ usuario.bairro }}" required>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Cidade</label>
                <input type="text" class="form-control" name="cidade" value="{{ usuario.cidade }}" required>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Estado</label>
                <select class="form-select" name="estado" required>
                  <option value="">Selecione...</option>
                  <option {% if usuario.estado == "MS" %}selected{% endif %}>MS</option>
                  <option {% if usuario.estado == "SP" %}selected{% endif %}>SP</option>
                  <option {% if usuario.estado == "RJ" %}selected{% endif %}>RJ</option>
                </select>
              </div>
            </div>

          
          </div>
          </div>


            <h4 class="mb-4 mt-5 border-bottom pb-2">Pagamento</h4>
            <div class="payment-options">
              {{ form.forma_pagamento }}
            </div>

            <hr class="my-5">

            <div class="row align-items-center flex-column-reverse flex-lg-row">
              <div class="col-lg-8">
                <p class="text-muted small text-center text-lg-start mb-3 mb-lg-0">
                  Ao confirmar, você concorda com nossos termos de serviço e políticas de privacidade.
                </p>
              </div>
              <div class="col-lg-4">
                <button type="submit" class="btn btn-checkout w-100 btn-lg" style="background-color: #288a0a; color: #ffffff;">Finalizar Pedido</button>
              </div>
            </div>
          </form>
        </div>

        <div class="mt-3">
          <a href="{% url 'core:ver_carrinho' %}" class="text-decoration-none text-muted">
            <i class="bi bi-arrow-left"></i> Voltar para o carrinho
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
