{% extends 'global/base.html' %}
{% load static %}

{% block head %}
  <title>{{ receita.nome }} - Aproveite+</title>
  <style>
    .recipe-detail-img {
      max-height: 450px;
      width: 100%;
      object-fit: cover;
      border-radius: 15px;
    }
    .recipe-meta {
      font-size: 1.1rem;
      color: #555;
    }
    .ingredient-list, .steps-list {
      padding-left: 20px;
    }
  </style>
{% endblock head %}

{% block content %}
<div class="container mt-5 mb-5">
  <div class="row">
    <div class="col-lg-8 offset-lg-2">

      <h1 class="display-4">{{ receita.nome }}</h1>
      <p class="lead text-muted">{{ receita.descricao }}</p>

      <div class="recipe-meta d-flex justify-content-around bg-light p-3 rounded mb-4">
        <span><strong>Autor:</strong> {{ receita.autor.username|default:"Desconhecido" }}</span>
        <span><strong>Preparo:</strong> {{ receita.tempo_preparo }} min</span>
        <span><strong>Rendimento:</strong> {{ receita.rendimento }}</span>
      </div>

      {% if receita.imagem %}
        <img src="{{ receita.imagem.url }}" alt="{{ receita.nome }}" class="img-fluid recipe-detail-img shadow-sm mb-4">
      {% endif %}

      <div class="row">
        <div class="col-md-5">
          <h3>Ingredientes</h3>
          <ul class="ingredient-list">
            {% for ingrediente in receita.ingredientes.all %}
              <li>{{ ingrediente.quantidade }} de {{ ingrediente.nome }}</li>
            {% empty %}
              <li>Nenhum ingrediente listado.</li>
            {% endfor %}
          </ul>
        </div>
        <div class="col-md-7">
          <h3>Modo de Preparo</h3>
          <ol class="steps-list">
            {% for etapa in receita.etapas.all %}
              <li class="mb-2">{{ etapa.descricao }}</li>
            {% empty %}
              <li>Nenhum modo de preparo listado.</li>
            {% endfor %}
          </ol>
        </div>
      </div>

      <hr class="my-5">

      <div class="mt-5">
          <h2>Avaliações da Receita</h2>
          <div id="avaliacoes-receita">
              <!-- As avaliações serão carregadas aqui via JavaScript ou renderizadas pelo backend -->
              <p>Nenhuma avaliação ainda. Seja o primeiro a avaliar!</p>
          </div>
          {% if user.is_authenticated %}
          <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#modalAvaliacaoReceita">Deixar uma Avaliação</button>
          {% else %}
          <p class="mt-3">Faça <a href="{% url 'core:telalogin' %}">login</a> para deixar uma avaliação.</p>
          {% endif %}
      </div>

      <div class="text-center mt-5">
        <a href="{% url 'core:receitas' %}" class="btn btn-secondary">Voltar para todas as receitas</a>
      </div>

    </div>
  </div>
</div>
{% include 'parciais/_avaliacao_modal_receita.html' %}
{% endblock content %}